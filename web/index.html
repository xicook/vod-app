<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<meta name="theme-color" content="#1a0b2e"/>

<title>x1co VOD üì°</title>

<style>

/* ========= RESET & FONTE ========= */

*{
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body{
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  color: white;
  background: #0a0118;
  padding-bottom: 90px;
  min-height: 100vh;
  overflow-x: hidden;
}

/* Background animado */
body::before{
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 20% 50%, rgba(147, 51, 234, 0.15) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(192, 132, 252, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 40% 20%, rgba(168, 85, 247, 0.08) 0%, transparent 40%);
  animation: bgPulse 15s ease-in-out infinite;
  pointer-events: none;
  z-index: 0;
}

@keyframes bgPulse{
  0%, 100%{ opacity: 1; }
  50%{ opacity: 0.7; }
}

/* Container para conte√∫do */
.content{
  position: relative;
  z-index: 1;
}


/* ========= HEADER √âPICO ========= */

.header{
  position: sticky;
  top: 0;
  z-index: 1000;
  background: rgba(10, 1, 24, 0.85);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid rgba(147, 51, 234, 0.2);
  box-shadow: 0 8px 32px rgba(147, 51, 234, 0.1);
}

.headerContent{
  padding: 16px 20px;
  max-width: 1400px;
  margin: 0 auto;
}

/* LOGO INCR√çVEL */
.logoContainer{
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
}

.logoIcon{
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, #9333ea 0%, #c084fc 100%);
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 26px;
  box-shadow: 
    0 8px 24px rgba(147, 51, 234, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
  position: relative;
  overflow: hidden;
}

.logoIcon::before{
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  animation: shine 3s infinite;
}

@keyframes shine{
  0%{ left: -100%; }
  50%, 100%{ left: 100%; }
}

.logoText{
  flex: 1;
}

.logoTitle{
  font-size: 24px;
  font-weight: 800;
  background: linear-gradient(135deg, #ffffff 0%, #c084fc 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: -0.5px;
}

.logoSubtitle{
  font-size: 12px;
  color: rgba(255, 255, 255, 0.5);
  font-weight: 500;
  margin-top: 2px;
}

/* Conex√£o */
.connectionBar{
  display: flex;
  gap: 10px;
}

.connectionBar input{
  flex: 1;
  padding: 14px 18px;
  background: rgba(255, 255, 255, 0.06);
  border: 2px solid rgba(147, 51, 234, 0.25);
  border-radius: 14px;
  color: white;
  font-size: 15px;
  outline: none;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.connectionBar input:focus{
  background: rgba(255, 255, 255, 0.1);
  border-color: #9333ea;
  box-shadow: 0 0 0 4px rgba(147, 51, 234, 0.15);
}

.connectionBar input::placeholder{
  color: rgba(255, 255, 255, 0.35);
}

.btnConnect{
  padding: 14px 24px;
  background: linear-gradient(135deg, #9333ea 0%, #7c3aed 100%);
  border: none;
  border-radius: 14px;
  color: white;
  font-weight: 700;
  font-size: 15px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 
    0 4px 16px rgba(147, 51, 234, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
  position: relative;
  overflow: hidden;
}

.btnConnect::before{
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
  opacity: 0;
  transition: opacity 0.3s;
}

.btnConnect:hover::before{
  opacity: 1;
}

.btnConnect:active{
  transform: scale(0.96);
}


/* ========= STATUS ========= */

.statusBar{
  padding: 16px 20px;
  text-align: center;
  background: rgba(147, 51, 234, 0.08);
  border-radius: 16px;
  margin: 20px;
  border: 1px solid rgba(147, 51, 234, 0.2);
  font-size: 16px;
  font-weight: 600;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 16px rgba(147, 51, 234, 0.1);
}


/* ========= GRID ========= */

.grid{
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 16px;
  padding: 20px;
  max-width: 1400px;
  margin: 0 auto;
}

@media (min-width: 480px){
  .grid{
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 18px;
  }
}

@media (min-width: 768px){
  .grid{
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
  }
}

@media (min-width: 1024px){
  .grid{
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 24px;
  }
}


/* ========= CARD ULTRA BONITO ========= */

.card{
  background: rgba(255, 255, 255, 0.04);
  border-radius: 20px;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  border: 1px solid rgba(147, 51, 234, 0.15);
  position: relative;
  backdrop-filter: blur(10px);
}

.card::after{
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(147, 51, 234, 0.15), rgba(192, 132, 252, 0.1));
  opacity: 0;
  transition: opacity 0.4s;
  pointer-events: none;
  border-radius: 20px;
}

.card:active{
  transform: scale(0.96);
}

@media (hover: hover){
  .card:hover{
    transform: translateY(-8px) scale(1.02);
    box-shadow: 
      0 20px 50px rgba(147, 51, 234, 0.3),
      0 0 0 1px rgba(147, 51, 234, 0.4);
  }
  
  .card:hover::after{
    opacity: 1;
  }
}

.thumbContainer{
  position: relative;
  overflow: hidden;
  background: linear-gradient(135deg, #1a0b2e 0%, #0f0520 100%);
  aspect-ratio: 16 / 9;
}

.thumb{
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

@media (hover: hover){
  .card:hover .thumb{
    transform: scale(1.15);
  }
}

.noThumb{
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #1a0b2e 0%, #0f0520 100%);
  font-size: 13px;
  color: rgba(255, 255, 255, 0.4);
}

.noThumb::before{
  content: '';
  width: 42px;
  height: 42px;
  margin-bottom: 8px;
  opacity: 0.25;
  background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMjMgN0wxNiAxMkwyMyAxN1Y3WiIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KICA8cGF0aCBkPSJNMSA1QzEgNC40Njk1NyAxLjIxMDcxIDMuOTYwODYgMS41ODU3OSAzLjU4NTc5QzEuOTYwODYgMy4yMTA3MSAyLjQ2OTU3IDMgMyAzSDEzQzEzLjUzMDQgMyAxNC4wMzkxIDMuMjEwNzEgMTQuNDE0MiAzLjU4NTc5QzE0Ljc4OTMgMy45NjA4NiAxNSA0LjQ2OTU3IDE1IDVWMTlDMTUgMTkuNTMwNCAxNC43ODkzIDIwLjAzOTEgMTQuNDE0MiAyMC40MTQyQzE0LjAzOTEgMjAuNzg5MyAxMy41MzA0IDIxIDEzIDIxSDNDMi40Njk1NyAyMSAxLjk2MDg2IDIwLjc4OTMgMS41ODU3OSAyMC40MTQyQzEuMjEwNzEgMjAuMDM5MSAxIDE5LjUzMDQgMSAxOVY1WiIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9zdmc+');
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
}

/* Play Button Overlay */
.playOverlay{
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.2) 50%, transparent 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.4s;
}

@media (hover: hover){
  .card:hover .playOverlay{
    opacity: 1;
  }
}

.playButton{
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: linear-gradient(135deg, #9333ea 0%, #7c3aed 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  box-shadow: 
    0 8px 32px rgba(147, 51, 234, 0.6),
    inset 0 2px 0 rgba(255, 255, 255, 0.2);
  transform: scale(0.8);
  transition: transform 0.3s;
}

@media (hover: hover){
  .card:hover .playButton{
    transform: scale(1);
  }
}

.playButton::after{
  content: '‚ñ∂';
  margin-left: 2px;
}

/* Badge de Views */
.viewsBadge{
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(10px);
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 4px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

/* Card Info */
.cardInfo{
  padding: 14px;
  background: rgba(0, 0, 0, 0.2);
}

.title{
  font-size: 15px;
  font-weight: 700;
  margin-bottom: 6px;
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  color: rgba(255, 255, 255, 0.95);
}

.views{
  font-size: 12px;
  color: rgba(255, 255, 255, 0.5);
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 5px;
}


/* ========= PLAYER MODERNO ========= */

.playerBox{
  position: fixed;
  bottom: 76px;
  left: 0;
  right: 0;
  background: #000;
  box-shadow: 
    0 -8px 32px rgba(0, 0, 0, 0.6),
    0 0 0 1px rgba(147, 51, 234, 0.3);
  z-index: 500;
  display: none;
}

.playerBox.active{
  display: block;
  animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideUp{
  from{
    transform: translateY(100%);
  }
  to{
    transform: translateY(0);
  }
}

video{
  width: 100%;
  max-height: 280px;
  display: block;
  background: #000;
}

@media (min-width: 768px){
  video{
    max-height: 400px;
  }
}


/* ========= NAVBAR GLASSMORPHISM ========= */

.nav{
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 76px;
  display: flex;
  justify-content: space-around;
  align-items: center;
  background: rgba(10, 1, 24, 0.9);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-top: 1px solid rgba(147, 51, 234, 0.2);
  z-index: 1000;
  box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.4);
  padding: 0 10px;
}

.navBtn{
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.5);
  padding: 12px 20px;
  border-radius: 16px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  min-width: 70px;
  position: relative;
}

.navBtn .icon{
  font-size: 26px;
  transition: transform 0.3s;
}

.navBtn .label{
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.navBtn:active{
  transform: scale(0.92);
}

.navBtn.active{
  color: #ffffff;
  background: rgba(147, 51, 234, 0.2);
}

.navBtn.active::before{
  content: '';
  position: absolute;
  top: -1px;
  left: 50%;
  transform: translateX(-50%);
  width: 32px;
  height: 3px;
  background: linear-gradient(90deg, #9333ea, #c084fc);
  border-radius: 0 0 3px 3px;
}

@media (hover: hover){
  .navBtn:hover:not(.active){
    color: rgba(255, 255, 255, 0.8);
    background: rgba(255, 255, 255, 0.05);
  }
  
  .navBtn:hover .icon{
    transform: translateY(-2px);
  }
}


/* ========= PERFIL ESTILOSO ========= */

.profileContainer{
  max-width: 480px;
  margin: 40px auto;
  padding: 20px;
}

.profileCard{
  background: rgba(255, 255, 255, 0.04);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(147, 51, 234, 0.2);
  border-radius: 28px;
  padding: 40px 28px;
  box-shadow: 
    0 20px 60px rgba(0, 0, 0, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.05);
  text-align: center;
}

.profileCard h2{
  font-size: 32px;
  font-weight: 900;
  margin-bottom: 12px;
  background: linear-gradient(135deg, #ffffff 0%, #c084fc 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.profileCard p{
  color: rgba(255, 255, 255, 0.6);
  font-size: 15px;
  margin-bottom: 32px;
  font-weight: 500;
}

.profileCard input{
  width: 100%;
  padding: 16px 20px;
  margin-bottom: 16px;
  background: rgba(255, 255, 255, 0.06);
  border: 2px solid rgba(147, 51, 234, 0.25);
  border-radius: 14px;
  color: white;
  font-size: 16px;
  outline: none;
  transition: all 0.3s;
}

.profileCard input:focus{
  background: rgba(255, 255, 255, 0.1);
  border-color: #9333ea;
  box-shadow: 0 0 0 4px rgba(147, 51, 234, 0.15);
}

.profileCard input::placeholder{
  color: rgba(255, 255, 255, 0.35);
}

.btnPrimary{
  width: 100%;
  padding: 16px;
  background: linear-gradient(135deg, #9333ea 0%, #7c3aed 100%);
  border: none;
  border-radius: 14px;
  color: white;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 
    0 8px 24px rgba(147, 51, 234, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
  margin-bottom: 12px;
}

.btnPrimary:active{
  transform: scale(0.98);
}

.btnSecondary{
  width: 100%;
  padding: 16px;
  background: rgba(255, 255, 255, 0.06);
  border: 2px solid rgba(147, 51, 234, 0.25);
  border-radius: 14px;
  color: white;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s;
}

.btnSecondary:active{
  transform: scale(0.98);
  background: rgba(255, 255, 255, 0.08);
}


/* ========= EMPTY STATE ========= */

.emptyState{
  grid-column: 1/-1;
  text-align: center;
  padding: 80px 20px;
}

.emptyState h3{
  font-size: 24px;
  font-weight: 800;
  margin-bottom: 12px;
  color: rgba(255, 255, 255, 0.9);
}

.emptyState p{
  color: rgba(255, 255, 255, 0.5);
  font-size: 15px;
  font-weight: 500;
  max-width: 300px;
  margin: 0 auto;
  line-height: 1.5;
}


/* ========= ANIMA√á√ïES ========= */

@keyframes fadeIn{
  from{
    opacity: 0;
    transform: translateY(20px);
  }
  to{
    opacity: 1;
    transform: translateY(0);
  }
}

.card{
  animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  opacity: 0;
}

.card:nth-child(1){ animation-delay: 0.05s; }
.card:nth-child(2){ animation-delay: 0.1s; }
.card:nth-child(3){ animation-delay: 0.15s; }
.card:nth-child(4){ animation-delay: 0.2s; }
.card:nth-child(5){ animation-delay: 0.25s; }
.card:nth-child(6){ animation-delay: 0.3s; }
.card:nth-child(7){ animation-delay: 0.35s; }
.card:nth-child(8){ animation-delay: 0.4s; }
.card:nth-child(9){ animation-delay: 0.45s; }
.card:nth-child(10){ animation-delay: 0.5s; }


/* ========= LOADING ========= */

.loading{
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  border-top-color: white;
  animation: spin 0.8s linear infinite;
}

@keyframes spin{
  to{ transform: rotate(360deg); }
}

</style>
</head>


<body>

<div class="content">

<!-- HEADER √âPICO -->
<header class="header">
  <div class="headerContent">
    <div class="logoContainer">
      <div class="logoIcon">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="white" fill-opacity="0.9"/>
          <path d="M2 17L12 22L22 17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          <path d="M2 12L12 17L22 12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </svg>
      </div>
      <div class="logoText">
        <div class="logoTitle">x1co VOD</div>
        <div class="logoSubtitle">Seu streaming pessoal</div>
      </div>
    </div>
    
    <div class="connectionBar">
      <input id="server" placeholder="127.0.0.1:8000" type="text">
      <button class="btnConnect" onclick="connect()">
        Conectar
      </button>
    </div>
  </div>
</header>

<!-- STATUS -->
<div id="status" class="statusBar">Aguardando servidor...</div>

<!-- LISTA DE V√çDEOS -->
<div id="list" class="grid"></div>

<!-- PLAYER -->
<div id="playerBox" class="playerBox">
  <video id="player" controls playsinline></video>
</div>

<!-- NAVBAR -->
<nav class="nav">
  <button id="navHome" class="navBtn active" onclick="goHome()">
    <div class="icon">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="label">In√≠cio</div>
  </button>
  <button id="navTrending" class="navBtn" onclick="goTrending()">
    <div class="icon">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2C12 2 8 6 8 10C8 12.2091 9.79086 14 12 14C14.2091 14 16 12.2091 16 10C16 6 12 2 12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M12 14C12 14 7 17 7 20C7 21.6569 8.34315 23 10 23H14C15.6569 23 17 21.6569 17 20C17 17 12 14 12 14Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="label">Em Alta</div>
  </button>
  <button id="navMe" class="navBtn" onclick="goMe()">
    <div class="icon">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="label">Perfil</div>
  </button>
</nav>

</div>



<script>

let base = localStorage.getItem("server") || ""
let token = localStorage.getItem("token") || ""

const list = document.getElementById("list")
const status = document.getElementById("status")
const player = document.getElementById("player")
const playerBox = document.getElementById("playerBox")

document.getElementById("server").value = base


/* ======================= */

function setStatus(t){
  status.innerText = t
}

function updateNavActive(active){
  document.querySelectorAll('.navBtn').forEach(btn => {
    btn.classList.remove('active')
  })
  document.getElementById('nav' + active).classList.add('active')
}


/* ======================= */

function connect(){
  const serverInput = document.getElementById("server").value
  
  if(!serverInput){
    alert("‚ùå Digite o endere√ßo do servidor!")
    return
  }
  
  base = "http://" + serverInput
  localStorage.setItem("server", serverInput)
  
  setStatus("üîÑ Conectando...")
  route()
}


/* ========= ROUTER ========= */

function navigate(path){
  history.pushState({}, "", path)
  route()
}

window.onpopstate = route

async function route(){
  const path = location.pathname

  if(path === "/trending-page"){
    loadTrending()
  }
  else if(path === "/me-page"){
    loadMe()
  }
  else{
    loadVideos()
  }
}


/* ========= HOME ========= */

async function loadVideos(){
  setStatus("P√°gina Inicial")
  updateNavActive('Home')

  try{
    const data = await fetch(base + "/videos").then(r=>r.json())
    renderVideos(data.videos)
  }catch(e){
    setStatus("‚ùå Erro ao conectar! Verifique o servidor.")
    list.innerHTML = `
      <div class="emptyState">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="opacity: 0.3; margin: 0 auto 20px;">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 9v4M12 17h.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h3>Sem conex√£o</h3>
        <p>N√£o foi poss√≠vel conectar ao servidor. Verifique se est√° rodando!</p>
      </div>
    `
  }
}


/* ========= TRENDING ========= */

async function loadTrending(){
  setStatus("V√≠deos em Alta")
  updateNavActive('Trending')

  try{
    const data = await fetch(base + "/trending").then(r=>r.json())
    renderVideos(data.videos)
  }catch(e){
    setStatus("‚ùå Erro ao carregar trending!")
    list.innerHTML = `
      <div class="emptyState">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="opacity: 0.3; margin: 0 auto 20px;">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 9v4M12 17h.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h3>Erro ao carregar</h3>
        <p>N√£o foi poss√≠vel buscar os v√≠deos em alta.</p>
      </div>
    `
  }
}


/* ========= PROFILE ========= */

async function loadMe(){
  setStatus("Meu Perfil")
  updateNavActive('Me')

  try{
    const res = await fetch(base + "/me", {
      headers:{ Authorization: token }
    }).then(r=>r.json())

    if(!res.logged){
      list.innerHTML = `
        <div class="profileContainer">
          <div class="profileCard">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 0 auto 20px; opacity: 0.8;">
              <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="url(#grad1)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="url(#grad1)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <defs>
                <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#9333ea;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#c084fc;stop-opacity:1" />
                </linearGradient>
              </defs>
            </svg>
            <h2>Entrar</h2>
            <p>Fa√ßa login para continuar</p>
            <input id="user" placeholder="Usu√°rio" type="text" autocomplete="username">
            <input id="pass" type="password" placeholder="Senha" autocomplete="current-password">
            <button class="btnPrimary" onclick="doLogin()">Fazer Login</button>
            <button class="btnSecondary" onclick="doRegister()">Criar Conta</button>
          </div>
        </div>
      `
      return
    }

    list.innerHTML = `
      <div class="profileContainer">
        <div class="profileCard">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 0 auto 20px; opacity: 0.8;">
            <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="url(#grad2)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="url(#grad2)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <defs>
              <linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#9333ea;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#c084fc;stop-opacity:1" />
              </linearGradient>
            </defs>
          </svg>
          <h2>${res.user}</h2>
          <p>Voc√™ est√° conectado! üéâ</p>
          <button class="btnPrimary" onclick="logout()">Sair da Conta</button>
        </div>
      </div>
    `
  }catch(e){
    setStatus("‚ùå Erro ao carregar perfil!")
    list.innerHTML = `
      <div class="emptyState">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="opacity: 0.3; margin: 0 auto 20px;">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 9v4M12 17h.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h3>Erro ao carregar</h3>
        <p>N√£o foi poss√≠vel carregar seu perfil.</p>
      </div>
    `
  }
}


/* ========= LOGIN ========= */

async function doLogin(){
  const u = document.getElementById('user').value
  const p = document.getElementById('pass').value

  if(!u || !p){
    alert("‚ùå Preencha todos os campos!")
    return
  }

  try{
    const res = await fetch(base + "/login",{
      method:"POST",
      headers:{ "Content-Type":"application/json"},
      body: JSON.stringify({user:u, pass:p})
    }).then(r=>r.json())

    if(res.ok){
      token = res.token
      localStorage.setItem("token", token)
      alert("‚úÖ Login feito com sucesso!")
      loadMe()
    }else{
      alert("‚ùå Usu√°rio ou senha incorretos!")
    }
  }catch(e){
    alert("‚ùå Erro ao fazer login!")
  }
}


async function doRegister(){
  const u = document.getElementById('user').value
  const p = document.getElementById('pass').value

  if(!u || !p){
    alert("‚ùå Preencha todos os campos!")
    return
  }

  try{
    await fetch(base + "/register",{
      method:"POST",
      headers:{ "Content-Type":"application/json"},
      body: JSON.stringify({user:u, pass:p})
    })

    alert("‚úÖ Conta criada! Agora fa√ßa login üòé")
  }catch(e){
    alert("‚ùå Erro ao criar conta!")
  }
}


async function logout(){
  try{
    await fetch(base + "/logout",{
      method:"POST",
      headers:{ Authorization: token }
    })

    token=""
    localStorage.removeItem("token")
    alert("‚úÖ Voc√™ saiu da conta!")
    loadMe()
  }catch(e){
    alert("‚ùå Erro ao sair!")
  }
}


/* ========= RENDER ========= */

function renderVideos(videos){
  list.innerHTML=""

  if(videos.length === 0){
    list.innerHTML = `
      <div class="emptyState">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="opacity: 0.3; margin: 0 auto 20px;">
          <path d="M22 19C22 19.5304 21.7893 20.0391 21.4142 20.4142C21.0391 20.7893 20.5304 21 20 21H4C3.46957 21 2.96086 20.7893 2.58579 20.4142C2.21071 20.0391 2 19.5304 2 19V5C2 4.46957 2.21071 3.96086 2.58579 3.58579C2.96086 3.21071 3.46957 3 4 3H9L11 6H20C20.5304 6 21.0391 6.21071 21.4142 6.58579C21.7893 6.96086 22 7.46957 22 8V19Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h3>Nenhum v√≠deo</h3>
        <p>Adicione v√≠deos na pasta 'videos' do servidor para come√ßar!</p>
      </div>
    `
    return
  }

  videos.forEach(v=>{
    const div = document.createElement("div")
    div.className="card"

    div.innerHTML = `
      <div class="thumbContainer">
        <img class="thumb"
          src="${base}/thumbs/${v.thumb}"
          alt="${v.title}"
          onerror="this.outerHTML='<div class=noThumb>Sem Thumbnail</div>'">
        
        <div class="playOverlay">
          <div class="playButton"></div>
        </div>
        
        <div class="viewsBadge">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="12" r="3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          ${formatViews(v.views)}
        </div>
      </div>

      <div class="cardInfo">
        <div class="title">${v.title}</div>
        <div class="views">${formatViews(v.views)} visualiza√ß√µes</div>
      </div>
    `

    div.onclick = ()=>{
      player.src = base + "/videos/" + v.file
      player.play()
      
      playerBox.classList.add('active')
      
      // Scroll suave pro player
      setTimeout(() => {
        window.scrollTo({ 
          top: document.body.scrollHeight, 
          behavior: 'smooth' 
        })
      }, 100)

      fetch(base + "/view/" + v.file, {method:"POST"})
        .then(() => {
          // Atualiza o contador de views no card
          const badge = div.querySelector('.viewsBadge')
          const viewsText = div.querySelector('.views')
          const newViews = v.views + 1
          badge.innerHTML = `
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="12" cy="12" r="3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            ${formatViews(newViews)}
          `
          viewsText.innerHTML = `${formatViews(newViews)} visualiza√ß√µes`
        })
    }

    list.appendChild(div)
  })
}

function formatViews(num){
  if(num >= 1000000){
    return (num / 1000000).toFixed(1) + 'M'
  }
  if(num >= 1000){
    return (num / 1000).toFixed(1) + 'k'
  }
  return num.toString()
}


/* ========= NAV ========= */

function goHome(){ navigate("/") }
function goTrending(){ navigate("/trending-page") }
function goMe(){ navigate("/me-page") }


/* ========= PLAYER CONTROLS ========= */

player.addEventListener('ended', () => {
  playerBox.classList.remove('active')
})

player.addEventListener('pause', () => {
  // Pode adicionar l√≥gica aqui se quiser
})


/* ========= INIT ========= */

if(base) route()

</script>

</body>
</html>

